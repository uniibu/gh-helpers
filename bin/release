#!/usr/bin/env node

const exec = require('../lib/exec');
const processor = require('../lib/processor');
const args = processor.parse(process.argv);

const releaseVer = args[0];
const publish = args[1];
const origin = 'origin'
let branch = exec.execa.shellSync('git branch', { encoding: 'utf8' })
branch = branch.stdout.replace(/^(\* )/g, '').replace('\n', '');

async function release() {
  let releaseArgs = `${releaseVer}`
  if (publish && publish == '--publish') {
    releaseArgs += ' --npm.publish'
  } else {
    releaseArgs += ' --no-npm.publish'
  }
  await exec(`yarn release-it ${releaseArgs}`);
}


exec(`gh-pull ${origin} ${branch}`)
  .then(() => release())
  .then(process.exit);